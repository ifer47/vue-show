1\. å®‰è£… [Element Plus](https://element-plus.org/zh-CN/)ï¼Œå…¨å®¶ç±»å‹ç»„ä»¶é…ç½®ç±»å‹æç¤ºï¼Œä¾èµ– Volarï¼Œtsconfig.app.json

```json
{
  // ...
  "compilerOptions": {
    // ...
    "types": ["element-plus/global"]
  }
}
```

2\. æ–°å»ºè‡ªå·±çš„ç»„ä»¶ï¼Œif-input/index.vueï¼Œå…¨å±€ä½¿ç”¨æ—¶å¦‚ä½•æ·»åŠ ç±»å‹æç¤ºï¼Œglobal.d.ts

```html
<template>
  <el-input />
</template>

<script setup lang="ts">
defineOptions({
  name: 'IfInput',
})
</script>
```

src\components\index.ts

```ts
import IfInput from './if-input/index.vue'
import { type App } from 'vue'
export default {
  install(app: App) {
    app.component(IfInput.name!, IfInput)
  },
}
```

src/global.d.ts

```ts
declare module 'vue' {
  export interface GlobalComponents {
    // ...
    IfInput: (typeof import('./components/if-input/index.vue'))['default']
  }
}
export {}
```

3\. å¦‚ä½•é›†æˆç¬¬ä¸‰æ–¹ç»„ä»¶çš„å±æ€§å’Œè‡ªå®šä¹‰äº‹ä»¶ç­‰

```html
<template>
  <el-input v-bind="$attrs" />
</template>

<script setup lang="ts">
defineOptions({
  name: 'IfInput',
})
</script>
```

æµ‹è¯•

```html
<script setup lang="ts">
import { ref } from 'vue'
const inputValue = ref('')
const onClear = () => {
  console.log('clear')
}
</script>

<template>
  <IfInput v-model="inputValue" clearable @clear="onClear" />
</template>
```

4\. åœ¨ `<IfInput />` ç»„ä»¶ä¸Šå†™ç›¸å…³å±æ€§æ—¶æ²¡æœ‰æç¤ºï¼Œå¦‚ä½•è§£å†³ï¼Œsrc/global.d.ts

```typescript
declare module 'vue' {
  export interface GlobalComponents {
    // ...
    IfInput: (typeof import('./components/if-input/index.vue'))['default'] &
      (typeof import('element-plus'))['ElInput']
  }
}
export {}
```

5\. å¦‚ä½•æ”¯æŒåŸç»„ä»¶æ–¹æ³•

App.vue

```html
<script setup lang="ts">
import { ref } from 'vue'
import type { IfInputInstance } from './components/if-input/index.vue'

const inputValue = ref('')
const onClear = () => {
  console.log('clear')
}

const ifInput = ref<IfInputInstance>()

const handleFocus = () => {
  ifInput.value?.focus()
}
</script>

<template>
  <IfInput ref="ifInput" v-model="inputValue" clearable @clear="onClear" />
  <el-button @click="handleFocus">Focus</el-button>
</template>

```

src\components\if-input\index.vue

```html
<template>
  <el-input v-bind="$attrs" ref="inputRef" />
</template>

<script setup lang="ts">
import type { ElInput } from 'element-plus'
import { ref, onMounted } from 'vue'

defineOptions({
  name: 'IfInput',
})

// ğŸ¯ æ–¹æ¡ˆ1ï¼šä½¿ç”¨æ¨¡æ¿å¼•ç”¨ï¼ˆæ¨èï¼‰
const inputRef = ref<InstanceType<typeof ElInput>>()
const expose: Record<string, unknown> = {}
onMounted(() => {
  // { a: 1, b: 2 } => [['a', 1], ['b', 2]]
  const entries = Object.entries(inputRef.value!)
  for (const [method, fn] of entries) {
    expose[method] = fn
  }
})
defineExpose(expose)

export type IfInputInstance = InstanceType<typeof ElInput>
</script>

```

å¦ä¸€ç§å†™æ³•ï¼Œref çš„å€¼å¯ä»¥æ˜¯ä¸€ä¸ªå‡½æ•°ï¼š

```html
<template>
  <el-input v-bind="$attrs" :ref="bindRef" />
</template>

<script setup lang="ts">
import type { ElInput } from 'element-plus'

defineOptions({
  name: 'IfInput',
})

const vm = getCurrentInstance()!
// ğŸ¯ æ–¹æ¡ˆ2ï¼šä½¿ç”¨ ref å›è°ƒï¼ˆå¦‚æœä½ æ›´å–œæ¬¢å›è°ƒæ–¹å¼ï¼‰
import { getCurrentInstance, type ComponentPublicInstance } from 'vue'
const bindRef = (el: ComponentPublicInstance | Element | null) => {
  vm.exposeProxy = vm.exposed = el
}
export type IfInputInstance = InstanceType<typeof ElInput>
</script>
```

6\. å¦‚ä½•é›†æˆç¬¬ä¸‰æ–¹æ’æ§½

```html
<template>
  <el-input v-bind="$attrs" ref="inputRef">
    <!-- 1. #[name] å¡«å‘ï¼Œå¡«åˆ°ç¬¬ä¸‰æ–¹çš„ el-inputï¼Œå¹¶å–å‡º el-input å†…éƒ¨æš´æ¼çš„æ•°æ® scopedData -->
    <template v-for="(_, name) in $slots" #[name]="scopedData">
      <!-- 2. å¡«çš„å†…å®¹æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå¡«çš„æ˜¯æ­¤å¤„é€šè¿‡ :name="name" æŒ–çš„å‘ï¼Œéœ€è¦å¤–éƒ¨å¡«è¿›æ¥ -->
      <slot :name="name" v-bind="scopedData || {}"></slot>
    </template>
  </el-input>
</template>

<script setup lang="ts">
import type { ElInput } from 'element-plus'
import { ref, onMounted } from 'vue'

defineOptions({
  name: 'IfInput',
})

const inputRef = ref<InstanceType<typeof ElInput>>()
const expose: Record<string, unknown> = {}
onMounted(() => {
  const entries = Object.entries(inputRef.value!)
  for (const [method, fn] of entries) {
    expose[method] = fn
  }
})
defineExpose(expose)

export type IfInputInstance = InstanceType<typeof ElInput>
</script>

```

App.vue

```html
<script setup lang="ts">
import { ref } from 'vue'
import type { IfInputInstance } from './components/if-input/index.vue'

const inputValue = ref('')
const onClear = () => {
  console.log('clear')
}

const ifInput = ref<IfInputInstance>()

const handleFocus = () => {
  ifInput.value?.focus()
}
</script>

<template>
  <IfInput ref="ifInput" v-model="inputValue" clearable @clear="onClear">
    <template #append>
      <el-button>æ¢¦æƒ³é‡‘å±±</el-button>
    </template>
  </IfInput>
  <el-button @click="handleFocus">Focus</el-button>
</template>

```

å¦ä¸€ç§æ–¹å¼

```html
<template>
  <!-- <component :is="h(ElInput as Component, { ...$attrs }, $slots)" ref="inputRef" /> -->
  <component :is="h(ElInput as Component, { ...$attrs, ref: bindRef }, $slots)" />
</template>

<script setup lang="ts">
import { h, type Component } from 'vue'
import { ElInput } from 'element-plus'

defineOptions({
  name: 'IfInput',
})

const vm = getCurrentInstance()!
import { getCurrentInstance, type ComponentPublicInstance } from 'vue'
const bindRef = (el: ComponentPublicInstance | Element | null) => {
  vm.exposeProxy = vm.exposed = el
}

export type IfInputInstance = InstanceType<typeof ElInput>
</script>

```

7\. å¦‚ä½•æ‰©å±•å±æ€§ï¼Œä¾‹å¦‚æ·»åŠ  shadow å±æ€§ï¼Œå½“æ»‘è¿‡æ—¶ä¼šæœ‰é˜´å½±æ•ˆæœï¼š

```html
<template>
  <!-- #3 -->
  <div :class="{ 'if-input': shadow }">
    <component :is="h(ElInput as Component, { ...$attrs, ref: bindRef }, $slots)" />
  </div>
</template>

<script setup lang="ts">
import { h, type Component } from 'vue'
import { ElInput } from 'element-plus'
import { getCurrentInstance, type ComponentPublicInstance } from 'vue'

defineOptions({
  name: 'IfInput',
})

// #2
type customProps = {
  shadow?: boolean
}
withDefaults(defineProps<customProps>(), {
  shadow: false,
})

const vm = getCurrentInstance()!

const bindRef = (el: ComponentPublicInstance | Element | null) => {
  vm.exposeProxy = vm.exposed = el
}
export type IfInputInstance = InstanceType<typeof ElInput>
</script>

<style scoped>
/* #1 */
.if-input {
  transition: 0.3s;
}
/* if-input:focus-within çš„ç›®çš„æ˜¯èšç„¦æ—¶æŒç»­ä¿æŒæ ·å¼æ•ˆæœ */
.if-input:hover,
.if-input:focus-within {
  filter: drop-shadow(0 0 3px rgba(0, 0, 0, 0.3));
}
</style>

```

8\. å¦‚ä½•æ‰©å±•æ–¹æ³•

```html
<template>
  <div :class="{ 'if-input': shadow }">
    <component :is="h(ElInput as Component, { ...$attrs, ref: bindRef }, $slots)" />
  </div>
</template>

<script setup lang="ts">
import { h, type Component } from 'vue'
import { ElInput } from 'element-plus'
import { getCurrentInstance, type ComponentPublicInstance } from 'vue'

defineOptions({
  name: 'IfInput',
})

type CustomProps = {
  shadow?: boolean
}
withDefaults(defineProps<CustomProps>(), {
  shadow: false,
})

const vm = getCurrentInstance()!

const xxx = () => {
  console.log('xxx')
}
const bindRef = (el: ComponentPublicInstance | Element | null) => {
  // #2
  vm.exposeProxy = vm.exposed = {
    ...el,
    xxx,
  }
}

// #1
type CustomInstance = InstanceType<typeof ElInput> & {
  xxx: () => void
}
export type IfInputInstance = CustomInstance
</script>

<style scoped>
.if-input {
  transition: 0.3s;
}
/* if-input:focus-within çš„ç›®çš„æ˜¯èšç„¦æ—¶æŒç»­ä¿æŒæ ·å¼æ•ˆæœ */
.if-input:hover,
.if-input:focus-within {
  filter: drop-shadow(0 0 3px rgba(0, 0, 0, 0.3));
}
</style>

```

9\. å¦‚ä½•æ‰©å±•æ’æ§½

```html
<template>
  <div :class="{ 'if-input': shadow }">
    <div v-if="$slots.title" class="if-input-title">
      <slot name="title"></slot>
    </div>
    <component :is="h(ElInput as Component, { ...$attrs, ref: bindRef }, $slots)" />
  </div>
</template>

<script setup lang="ts">
import { h, type Component } from 'vue'
import { ElInput } from 'element-plus'
import { getCurrentInstance, type ComponentPublicInstance } from 'vue'

defineOptions({
  name: 'IfInput',
})

type CustomProps = {
  shadow?: boolean
}
withDefaults(defineProps<CustomProps>(), {
  shadow: false,
})

const vm = getCurrentInstance()!

const xxx = () => {
  console.log('xxx')
}
const bindRef = (el: ComponentPublicInstance | Element | null) => {
  // #2
  vm.exposeProxy = vm.exposed = {
    ...el,
    xxx,
  }
}

// #1
type CustomInstance = InstanceType<typeof ElInput> & {
  xxx: () => void
}
export type IfInputInstance = CustomInstance
</script>

<style scoped>
.if-input {
  transition: 0.3s;
}
/* if-input:focus-within çš„ç›®çš„æ˜¯èšç„¦æ—¶æŒç»­ä¿æŒæ ·å¼æ•ˆæœ */
.if-input:hover,
.if-input:focus-within {
  filter: drop-shadow(0 0 3px rgba(0, 0, 0, 0.3));
}

.if-input-title {
  text-align: center;
  font-family: cursive;
  color: #333;
}
</style>

```

10\. æ ¹æ®éœ€è¦è€ƒè™‘æ˜¯å¦å…³é—­ inheritAttrsï¼Œä¾‹å¦‚ a ä¼šåŒæ—¶å­˜åœ¨äºæ ¹èŠ‚ç‚¹å’Œ `<el-input/>` ç»„ä»¶

```html
<IfInput a="1" ... />
```

```ts
defineOptions({
  name: 'IfInput',
  inheritAttrs: false,
})
```
